#!/bin/bash
set -eu
jar_url=http://www.browserstack.com/BrowserStackTunnel.jar
conf_dir="$(dirname $0)/.browserstack-tunnel"
local_jar="$conf_dir/$(basename $jar_url)"
config_file="$conf_dir/config.sh"

# java -jar BrowserStackTunnel.jar PLPst3cUytWgWy8StwyM localhost,3000,1

if [ ! -e $conf_dir ]; then
  echo "Creating directory $conf_dir"
  mkdir $conf_dir
fi

if [ ! -e $local_jar ]; then
  echo "Fetching jar: $jar_url => $local_jar"
  curl -o $local_jar  $jar_url 
fi

if [ ! -e $config_file ]; then
  echo "You must now create $config_file, and place within it"
  echo ""
  echo "  export BROWSERSTACK_PRIVATE_KEY=<<your private key>>"
  echo ""
fi


port="${1:-3000}"
bind_address="${2:-localhost}"
ssl_flag="${ssl_flag:-0}"

. $config_file


echo "Tunneling: $bind_address:$port"
echo java -jar "$local_jar" "$BROWSERSTACK_PRIVATE_KEY" "$bind_address,$port,$port,$ssl_flag"
java -jar "$local_jar" "$BROWSERSTACK_PRIVATE_KEY" "$bind_address,$port,$ssl_flag"


